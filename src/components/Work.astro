---
import { Image, getImage } from 'astro:assets';
import work1Main from '../assets/Work1.png';
import work1_1 from '../assets/Work1.1.png';
import work1_2 from '../assets/Work1.2.png';
import work2Main from '../assets/Work2.png';
import work2_1 from '../assets/Work2.1.png';
import work2_2 from '../assets/Work2.2.png';
import work3Main from '../assets/Work3.png';
import work3_1 from '../assets/Work3.1.png';
import work3_2 from '../assets/Work3.2.png';

const projects = [
  {
    title: 'Professional Services',
    description:
      'Professional websites for legal practices, featuring clear navigation and trust-building design.',
    images: [work1Main, work1_1, work1_2],
  },
  {
    title: 'Financial Services',
    description:
      'Modern, user-friendly sites that make complex insurance information accessible and easy to understand.',
    images: [work2Main, work2_1, work2_2],
  },
  {
    title: 'Logistics & Distribution',
    description:
      'Streamlined websites for distribution companies, focused on showcasing services and facilitating enquiries.',
    images: [work3Main, work3_1, work3_2],
  },
];

// Generate optimized full-size images for modal
const processedProjects = await Promise.all(
  projects.map(async (project) => ({
    ...project,
    images: await Promise.all(
      project.images.map(async (image) => {
        const optimized = await getImage({
          src: image,
          width: 1920,
          format: 'webp',
          quality: 90,
        });
        return {
          original: image,
          optimizedSrc: optimized.src,
        };
      })
    ),
  }))
);
---

<section id="work" class="py-12 px-4 sm:py-16 sm:px-6 md:py-20 lg:py-10 bg-section-bg">
  <div class="max-w-6xl mx-auto">
    <div class="mb-6 sm:mb-8 work-header text-center">
      <h2 class="text-2xl sm:text-3xl md:text-4xl lg:text-4xl font-bold mb-2">Selected work</h2>
      <p class="text-white/90 text-sm sm:text-base font-semibold">
        Examples delivered as part of my role at a UK digital agency
      </p>
    </div>

    <div class="space-y-8 sm:space-y-10 md:space-y-12">
      {
        processedProjects.map((project: any, index: number) => (
          <article
            class={`work-card ${index < processedProjects.length - 1 ? 'pb-8 sm:pb-10 md:pb-12 border-b' : ''}`}
            data-index={index}
          >
            <div class="mb-4 sm:mb-6">
              <h3 class="text-xl sm:text-2xl md:text-3xl lg:text-3xl font-bold mb-2 text-primary">
                {project.title}
              </h3>
              <p class="text-white/90 text-sm sm:text-base font-semibold">{project.description}</p>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 md:gap-6">
              {project.images.map((imageData: any, imgIndex: number) => (
                <button
                  type="button"
                  data-image-src={String(imageData.optimizedSrc || '')}
                  data-image-alt={`${project.title} screenshot ${imgIndex + 1}`}
                  class="work-image-btn bg-section-bg rounded-lg sm:rounded-xl overflow-hidden border group hover:-translate-y-1 transition-all duration-300 cursor-pointer text-left w-full transform-gpu"
                  aria-label={`View ${project.title} screenshot ${imgIndex + 1} in larger view`}
                >
                  <div class="relative overflow-hidden aspect-video">
                    <Image
                      src={imageData.original}
                      alt={`${project.title} screenshot ${imgIndex + 1}`}
                      width={800}
                      height={450}
                      format="webp"
                      quality={80}
                      loading="lazy"
                      class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500 transform-gpu"
                    />
                  </div>
                </button>
              ))}
            </div>
          </article>
        ))
      }
    </div>
  </div>
</section>

<div
  id="imageModal"
  class="fixed inset-0 z-50 hidden items-center justify-center bg-black/90 backdrop-blur-sm"
  onclick="closeImageModal()"
  role="dialog"
  aria-modal="true"
  aria-labelledby="modalTitle"
>
  <button
    onclick="closeImageModal()"
    class="absolute top-4 right-4 text-white/90 hover:text-white transition-colors"
    aria-label="Close image modal"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="32"
      height="32"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      aria-hidden="true"
    >
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
  </button>
  <div class="max-w-7xl mx-auto px-4 sm:px-6" onclick="event.stopPropagation()">
    <h2 id="modalTitle" class="sr-only">Image viewer</h2>
    <img id="modalImage" src="" alt="" class="max-h-[90vh] w-auto mx-auto rounded-lg" />
  </div>
</div>

<script src="../scripts/image-modal.ts"></script>
